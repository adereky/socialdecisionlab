<!doctype html>
<html>
    <head>
        <title>Timgroup: Experiment 1</title>
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
        <script src="./jsPsych-4.3/jquery.min.js"></script>
        <script src="./jsPsych-4.3/jspsych.js"></script>
        <script src="./jsPsych-4.3/plugins/jspsych-instructions.js"></script>
        <script src="./jsPsych-4.3/plugins/jspsych-html-input-ao.js"></script>
        <script src="./jsPsych-4.3/plugins/jspsych-fullscreen.js"></script>
        <script src="./jsPsych-4.3/plugins/jspsych-anna.js"></script>
        <script src="./timeline.js"></script>
        <script src="./guiInfo.js"></script>
        <script src="./userInfo.js"></script>
        <script src="./imgData.js"></script>
        <!-- <script> var ip = "<?php echo $_SERVER['REMOTE_ADDR']; ?>";</script> -->
        <link href="./jsPsych-4.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body>
    </body>
    <script>

    var User = {
      urlHasId : function(){
        if (Object.keys(jsPsych.data.fromURL()).indexOf('id') > -1){
          return true;
        }else{
          return false;
        };
      },
      urlId : function(){
        return jsPsych.data.fromURL('id')['id'];
      },
      checkId : function(){
        var userInfoIds = userInfo.map(function(i){return i['UID']});
        if (userInfoIds.indexOf(this.Id) > -1){
          return true;
        }else{
          return false;
        };
      },
      setId : function(){
        if (this.urlHasId()){
          this.Id = this.urlId();
        }else{
          this.Id = prompt('Bitte geben sie Ihren persoenlichen Code ein:')
        };
      },
      getUserInfo : function(){
        var tempId = this.Id
        var t = userInfo.filter(function(i){
          return i['UID'] == tempId});
        return t[0];
      },
      init : function(){
        this.setId()
        var idx = 1;
        while(!this.checkId()&&idx<3){
          var tempId = prompt('Der angegebene persoenliche Code ist nicht korrekt. Probieren Sie es noch einmal:');
          this.Id = tempId;
          idx= idx+1;
        };
        if (idx>=3){
          this.abort();
        }else{
          userObject = this.getUserInfo();
          userObject.Status = 'ready';
          return userObject
        };
      },
      abort:function(){
          $('body').html('Sie haben 3 mal eine Falsche User Id angegeben. Bitte kontaktieren Sie Anna Dereky.')
          return {Status:'error'};
      }
    };

    var Env = {
      screenW: screen.width,
      screenH : screen.height,
      centX : this.screenW*0.5,
      centY : this.screenH*0.5
    };

    var Experiment = {
      User: User.init(),
      Env: Env,
      displayStr : function(str){
        $('body').html(str);
      },
      imgPaths : function(){
        regularPaths = imgData.regular.map(function(i){
          return i['path'];
        });
        fractalPaths = imgData.fractals.map(function(i){
          return i['path'];
        });
        imgPaths =  regularPaths.concat(fractalPaths);
        return imgPaths;
      },
      items : function(){
        items = jsPsych.randomization.shuffle(timeline.splice(10));
        return items;
      },
      expTimeline:function(){
        t = {
          type:'anna',
          items : this.items()
        };
        return t;
      },
      preLoadImages : function(){
        this.displayStr('Loading Images');
        var t0=Date.now();
        var t1 = (Date.now()-t0)/1000.0;
        jsPsych.preloadImages(this.imgPaths,this.startJsPsych(t1));
      },
      startJsPsych : function(t1){
        this.displayStr('Images loaded after: '+t1.toString()+' s');
        // Initiate jsPsych experiment here
        // jsPsych.init({
        //   experiment_structure: this.expTimeline()
        // });
      },
      init : function(){
        if (this.User.Status=='ready'){
          this.preLoadImages()
        }
      }
    };

    Experiment.init()

    </script>
</html>
